name: Connection Test

on:
  push:
  pull_request:
   types: [opened, synchronize]

jobs:
 send-curl:
   runs-on: ubuntu-latest

   steps:
     - name: Send curl request
       env: 
         SECRET_JSON: ${{ secrets.SECRET_JSON }}
         URL: ${{ secrets.URL }}
       run: |
        USERNAME=$(echo "$SECRET_JSON" | jq -r '.[] | select(.username == "michal@crtc.mq.edu.au") | .username' )
        PASSWORD=$(echo "$SECRET_JSON" | jq -r '.[] | select(.username == "michal@crtc.mq.edu.au") | .password' )
        BODY=$(echo "$SECRET_JSON" | jq -r '.[] | select(.username == "michal@crtc.mq.edu.au") | .body' )
        curl -u $USERNAME:$PASSWORD -X POST -d "$BODY" "$URL"